# 绝缘子破损检测 - 标注指南

## 标注方案：整串 + 破损局部（电力巡检标准做法）

本方案符合**电力巡检真实做法**，是工业界推荐的标注方式。

---

## 类别设计

| 类别ID | 类别名称 | 说明 | 框的大小 |
|--------|----------|------|----------|
| 0 | insulator | 绝缘子整串 | 大框 |
| 1 | broken_part | 破损的那一片 | 小框 |

---

## 标注规则

### 规则 1：所有绝缘子串 → 标注为 insulator

无论绝缘子是否破损，**整串绝缘子**都要用一个大框标注为 `insulator`。

```
┌─────────────────────────┐
│     insulator (大框)     │  ← 框住整串绝缘子
│   ○ ○ ○ ○ ○ ○ ○ ○ ○   │
│   ○ ○ ○ ○ ○ ○ ○ ○ ○   │
└─────────────────────────┘
```

### 规则 2：破损的那一片 → 单独框 → broken_part

如果绝缘子有破损，在标注整串的基础上，**单独用一个小框**框住破损的那一片。

```
┌─────────────────────────┐
│     insulator (大框)     │
│   ○ ○ ○ ○ ○ ○ ○ ○ ○   │
│   ○ ○ ○ ┌───┐ ○ ○ ○   │  ← broken_part 小框
│   ○ ○ ○ │ ✕ │ ○ ○ ○   │     只框住破损的那一片
│   ○ ○ ○ └───┘ ○ ○ ○   │
└─────────────────────────┘
```

### 规则 3：一张图可能有多个框

- **正常绝缘子**：只有 1 个框 → `insulator`
- **破损绝缘子**：有 2 个框 → `insulator` + `broken_part`
- **多串绝缘子**：每串一个 `insulator`，有破损的再加 `broken_part`

---

## 标注示例

### 示例 1：正常绝缘子（无破损）

**只有 insulator，无 broken_part**

```
图像中：一整串完好的绝缘子

标注文件 (.txt)：
0 0.5 0.5 0.3 0.2    ← 只有 insulator (class 0)
```

### 示例 2：破损绝缘子

**有 insulator + broken_part**

```
图像中：一串绝缘子，其中第 4 片破损

标注文件 (.txt)：
0 0.5 0.5 0.35 0.25   ← insulator：整串的大框
1 0.52 0.58 0.08 0.06 ← broken_part：破损片的小框
```

### 示例 3：多串绝缘子，其中一串有破损

```
图像中：3 串绝缘子，第 2 串有破损

标注文件 (.txt)：
0 0.2 0.3 0.15 0.2    ← 第 1 串 insulator
0 0.5 0.3 0.15 0.2    ← 第 2 串 insulator
1 0.52 0.35 0.04 0.05 ← 第 2 串的破损片 broken_part
0 0.8 0.3 0.15 0.2    ← 第 3 串 insulator
```

---

## YOLO 标注格式

每行一个目标，格式为：
```
class_id x_center y_center width height
```

- 所有坐标均为**归一化值**（0~1），相对于图像宽高
- `x_center`, `y_center`：边界框中心点
- `width`, `height`：边界框宽高

---

## 框的绘制要点

### insulator（整串）框
- ✅ 框住**整串**绝缘子，从第一片到最后一片
- ✅ 边界适当留一点余量
- ❌ 不要只框住部分绝缘子

### broken_part（破损局部）框
- ✅ **紧贴**破损的那一片
- ✅ 只框住破损区域，不要框太大
- ✅ 可以包含破损片的碎片、缺失部分
- ❌ 不要框住多片绝缘子

---

## 为什么采用这种方案？

### 符合电力巡检实际
- 巡检时先**定位整串绝缘子**（insulator）
- 再**精确定位破损位置**（broken_part）
- 便于维修人员快速找到问题点

### 模型效果更好
- 整串检测：大目标，容易学习
- 破损定位：小目标，精确定位
- 两个任务互补，提升整体性能

### 工业应用价值高
- 能检测整串位置
- 能精确定位破损
- 输出信息更丰富，便于后续处理

---

## 标注工具推荐

- **LabelImg**：https://github.com/HumanSignal/labelImg
- **Label Studio**：https://labelstud.io/
- **CVAT**：https://www.cvat.ai/

使用前请将类别设置为：
- `insulator` (或 0)
- `broken_part` (或 1)

---

## 旧标注转换说明

如果之前使用的是 `normal_insulator` / `broken_insulator` 方案：

| 旧标注 | 新标注 | 操作 |
|--------|--------|------|
| normal_insulator (整串) | insulator | 直接改为 class 0，框不变 |
| broken_insulator (整串) | insulator + broken_part | **需要重新标注**：添加整串框，原框改为只框破损片 |

**重要**：原 `broken_insulator` 的框是整串，需要拆分为：
1. insulator：整串大框（可沿用原框或重新画）
2. broken_part：在破损位置新画小框

可使用 `scripts/convert_labels.py` 辅助转换（见下方）。

---

## 常见问题

**Q: 破损很小，框很难画怎么办？**
A: 尽量紧贴破损区域，即使很小也要标注。小目标检测是模型的重点优化方向。

**Q: 一片绝缘子缺了一角，算破损吗？**
A: 算。只要有任何缺失、裂纹、破损，都标注为 broken_part。

**Q: 多串绝缘子在同一张图，都要标吗？**
A: 是的。每串绝缘子都要标 insulator，有破损的再加 broken_part。

---

**标注质量直接影响模型效果，请认真标注！**
